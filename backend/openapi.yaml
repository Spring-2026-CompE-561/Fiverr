openapi: 3.0.3
info:
 title: Giglink Marketplace API
 version: 1.0.0
 description: >
   A scoped-down Fiverr-like marketplace without payments.
   Users register as buyers or sellers. Sellers create gigs. Buyers place orders/requests.
   Sellers accept/reject/complete orders. Buyers can leave reviews.


servers:
 - url: http://localhost:8000


tags:
 - name: Auth
 - name: Users
 - name: Gigs
 - name: Orders
 - name: Reviews


paths:
 # ---------------------------
 # AUTH
 # ---------------------------
 /api/auth/register:
   post:
     tags: [Auth]
     summary: Register a new user (buyer or seller)
     requestBody:
       required: true
       content:
         application/json:
           schema:
             $ref: "#/components/schemas/RegisterRequest"
     responses:
       "201":
         description: User registered successfully
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/AuthResponse"
       "400":
         description: Validation error or duplicate email
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


 /api/auth/login:
   post:
     tags: [Auth]
     summary: Login and receive JWT token
     requestBody:
       required: true
       content:
         application/json:
           schema:
             $ref: "#/components/schemas/LoginRequest"
     responses:
       "200":
         description: Logged in successfully
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/AuthResponse"
       "401":
         description: Invalid credentials
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


   # ---------------------------
   # ENUMS
   # ---------------------------
   UserRole:
     type: string
     enum: [buyer, seller]


   OrderStatus:
     type: string
     enum: [pending, accepted, rejected, completed]


   # ---------------------------
   # AUTH SCHEMAS
   # ---------------------------
   RegisterRequest:
     type: object
     required: [name, email, password, role]
     properties:
       name: { type: string, minLength: 1 }
       email: { type: string, format: email }
       password: { type: string, minLength: 6 }
       role:
         $ref: "#/components/schemas/UserRole"


   LoginRequest:
     type: object
     required: [email, password]
     properties:
       email: { type: string, format: email }
       password: { type: string }


   AuthResponse:
     type: object
     properties:
       success: { type: boolean, example: true }
       token: { type: string, example: "jwt.token.here" }
       user:
         $ref: "#/components/schemas/UserPublic"
         
# ---------------------------
 # REVIEWS
 # ---------------------------
 /api/reviews:
   post:
     tags: [Reviews]
     summary: Create a review (buyer only; typically after a completed order)
     security:
       - bearerAuth: []
     requestBody:
       required: true
       content:
         application/json:
           schema:
             $ref: "#/components/schemas/ReviewCreate"
     responses:
       "201":
         description: Review created
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/SuccessReviewResponse"
       "401":
         description: Not authenticated
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "403":
         description: Forbidden (seller cannot create reviews)
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "404":
         description: Gig not found
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


 /api/gigs/{id}/reviews:
   get:
     tags: [Reviews]
     summary: Get all reviews for a gig
     parameters:
       - name: id
         in: path
         required: true
         schema: { type: string }
     responses:
       "200":
         description: List of reviews for the gig
         content:
           application/json:
             schema:
               type: array
               items:
                 $ref: "#/components/schemas/ReviewPublic"


 /api/reviews/{id}:
   delete:
     tags: [Reviews]
     summary: Delete a review (owner/admin)
     security:
       - bearerAuth: []
     parameters:
       - name: id
         in: path
         required: true
         schema: { type: string }
     responses:
       "200":
         description: Review deleted
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/SuccessResponse"
       "401":
         description: Not authenticated
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "403":
         description: Forbidden (not review owner)
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "404":
         description: Review not found
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


components:
 securitySchemes:
   bearerAuth:
     type: http
     scheme: bearer
     bearerFormat: JWT
# ---------------------------
   # REVIEW SCHEMAS
   # ---------------------------
   ReviewCreate:
     type: object
     required: [gigId, rating]
     properties:
       gigId: { type: string }
       rating: { type: integer, minimum: 1, maximum: 5 }
       comment: { type: string }


   ReviewPublic:
     type: object
     properties:
       id: { type: string }
       gig_id: { type: string }
       buyer_id: { type: string }
       rating: { type: integer, minimum: 1, maximum: 5 }
       comment: { type: string, nullable: true }
       created_at: { type: string, format: date-time }


   SuccessReviewResponse:
     type: object
     properties:
       success: { type: boolean, example: true }
       review:
         $ref: "#/components/schemas/ReviewPublic"


   # ---------------------------
   # GENERIC RESPONSES
   # ---------------------------
   SuccessResponse:
     type: object
     properties:
       success: { type: boolean, example: true }
       message: { type: string, example: "OK" }


   ErrorResponse:
     type: object
     properties:
       success: { type: boolean, example: false }
       error:
         type: object
         properties:
           code: { type: string, example: "VALIDATION_ERROR" }
           message: { type: string, example: "Something went wrong" }
           details:
             type: object
             additionalProperties: true



