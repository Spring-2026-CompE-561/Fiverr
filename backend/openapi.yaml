openapi: 3.0.3
info:
 title: Giglink Marketplace API
 version: 1.0.0
 description: >
   A scoped-down Fiverr-like marketplace without payments.
   Users register as buyers or sellers. Sellers create gigs. Buyers place orders/requests.
   Sellers accept/reject/complete orders. Buyers can leave reviews.


servers:
 - url: http://localhost:8000


tags:
 - name: Auth
 - name: Users
 - name: Gigs
 - name: Orders
 - name: Reviews


paths:
 # ---------------------------
 # AUTH
 # ---------------------------
 /api/auth/register:
   post:
     tags: [Auth]
     summary: Register a new user (buyer or seller)
     requestBody:
       required: true
       content:
         application/json:
           schema:
             $ref: "#/components/schemas/RegisterRequest"
     responses:
       "201":
         description: User registered successfully
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/AuthResponse"
       "400":
         description: Validation error or duplicate email
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


 /api/auth/login:
   post:
     tags: [Auth]
     summary: Login and receive JWT token
     requestBody:
       required: true
       content:
         application/json:
           schema:
             $ref: "#/components/schemas/LoginRequest"
     responses:
       "200":
         description: Logged in successfully
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/AuthResponse"
       "401":
         description: Invalid credentials
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


   # ---------------------------
   # ENUMS
   # ---------------------------
   UserRole:
     type: string
     enum: [buyer, seller]


   OrderStatus:
     type: string
     enum: [pending, accepted, rejected, completed]


   # ---------------------------
   # AUTH SCHEMAS
   # ---------------------------
   RegisterRequest:
     type: object
     required: [name, email, password, role]
     properties:
       name: { type: string, minLength: 1 }
       email: { type: string, format: email }
       password: { type: string, minLength: 6 }
       role:
         $ref: "#/components/schemas/UserRole"


   LoginRequest:
     type: object
     required: [email, password]
     properties:
       email: { type: string, format: email }
       password: { type: string }


   AuthResponse:
     type: object
     properties:
       success: { type: boolean, example: true }
       token: { type: string, example: "jwt.token.here" }
       user:
         $ref: "#/components/schemas/UserPublic"

 # ---------------------------
 # ORDERS
 # ---------------------------
 /api/orders:
   post:
     tags: [Orders]
     summary: Create an order/request for a gig (buyer only)
     security:
       - bearerAuth: []
     requestBody:
       required: true
       content:
         application/json:
           schema:
             $ref: "#/components/schemas/OrderCreate"
     responses:
       "201":
         description: Order created
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/SuccessOrderResponse"
       "401":
         description: Not authenticated
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "403":
         description: Forbidden (seller cannot create orders)
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "404":
         description: Gig not found
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


   get:
     tags: [Orders]
     summary: List orders for logged-in user (buyers placed, sellers received)
     security:
       - bearerAuth: []
     parameters:
       - name: status
         in: query
         required: false
         schema:
           $ref: "#/components/schemas/OrderStatus"
     responses:
       "200":
         description: List of orders
         content:
           application/json:
             schema:
               type: array
               items:
                 $ref: "#/components/schemas/OrderPublic"
       "401":
         description: Not authenticated
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


 /api/orders/{id}:
   get:
     tags: [Orders]
     summary: Get a single order by id
     security:
       - bearerAuth: []
     parameters:
       - name: id
         in: path
         required: true
         schema: { type: string }
     responses:
       "200":
         description: Order details
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/OrderPublic"
       "401":
         description: Not authenticated
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "404":
         description: Order not found
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


   put:
     tags: [Orders]
     summary: Update order status (seller only; accept/reject/complete)
     security:
       - bearerAuth: []
     parameters:
       - name: id
         in: path
         required: true
         schema: { type: string }
     requestBody:
       required: true
       content:
         application/json:
           schema:
             $ref: "#/components/schemas/OrderUpdate"
     responses:
       "200":
         description: Order updated
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/SuccessOrderResponse"
       "401":
         description: Not authenticated
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "403":
         description: Forbidden (buyer cannot change status / not owner)
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "404":
         description: Order not found
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"


   delete:
     tags: [Orders]
     summary: Cancel an order (buyer only; typically only if pending)
     security:
       - bearerAuth: []
     parameters:
       - name: id
         in: path
         required: true
         schema: { type: string }
     responses:
       "200":
         description: Order cancelled
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/SuccessResponse"
       "401":
         description: Not authenticated
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "403":
         description: Forbidden (seller cannot cancel / not allowed)
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
       "404":
         description: Order not found
         content:
           application/json:
             schema:
               $ref: "#/components/schemas/ErrorResponse"
   # ---------------------------
   # ORDER SCHEMAS
   # ---------------------------
   OrderCreate:
     type: object
     required: [gigId, message]
     properties:
       gigId: { type: string }
       message: { type: string, minLength: 1 }


   OrderUpdate:
     type: object
     required: [status]
     properties:
       status:
         $ref: "#/components/schemas/OrderStatus"


   OrderPublic:
     type: object
     properties:
       id: { type: string }
       gig_id: { type: string }
       buyer_id: { type: string }
       message: { type: string }
       status:
         $ref: "#/components/schemas/OrderStatus"
       created_at: { type: string, format: date-time }
       updated_at: { type: string, format: date-time }


   SuccessOrderResponse:
     type: object
     properties:
       success: { type: boolean, example: true }
       order:
         $ref: "#/components/schemas/OrderPublic"
